{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kassymzhan.nuraliyev\\\\OneDrive - KAZ Minerals Management LLP\\\\Desktop\\\\Tablo\\\\Tablo\\\\frontend\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/contexts/AuthContext.js\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport apiService from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  // frontend/src/contexts/AuthContext.js\n\n  const checkAuth = async () => {\n    console.log('üîê Checking authentication...');\n    try {\n      const token = localStorage.getItem('token');\n      const savedUser = localStorage.getItem('user');\n      console.log('üì¶ Saved data:', {\n        hasToken: !!token,\n        hasUser: !!savedUser,\n        token: token ? `${token.substring(0, 20)}...` : 'none'\n      });\n      if (token && savedUser) {\n        console.log('‚úÖ Found saved token and user');\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ /api/auth/verify\n        try {\n          const response = await api.get('/auth/verify');\n          if (response.status === 200) {\n            const userData = JSON.parse(savedUser);\n            setUser(userData);\n            console.log('‚úÖ User restored:', userData);\n          } else {\n            throw new Error('Token validation failed');\n          }\n        } catch (verifyError) {\n          console.log('‚ùå Token invalid, clearing...', verifyError.message);\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          setUser(null);\n        }\n      } else {\n        console.log('‚ÑπÔ∏è No saved authentication found');\n        setUser(null);\n      }\n    } catch (err) {\n      console.error('‚ùå Auth check error:', err);\n      setError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');\n      setUser(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const login = async (email, password) => {\n    console.log('Login attempt for:', email);\n    setLoading(true);\n    setError(null);\n    try {\n      const result = await apiService.login(email, password);\n      if (result.success) {\n        console.log('Login successful:', result.data);\n        setUser(result.data.user);\n        setError(null);\n        return {\n          success: true\n        };\n      } else {\n        console.log('Login failed:', result.error);\n        setError(result.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');\n        return {\n          success: false,\n          error: result.error\n        };\n      }\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('Login error:', err);\n      const errorMessage = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';\n      setError(errorMessage);\n      return {\n        success: false,\n        error: errorMessage\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const logout = () => {\n    console.log('Logging out...');\n    setUser(null);\n    setError(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    // –ù–µ –¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –∑–¥–µ—Å—å, –ø—É—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç\n  };\n  const hasRole = requiredRoles => {\n    if (!user) return false;\n    if (!Array.isArray(requiredRoles)) {\n      requiredRoles = [requiredRoles];\n    }\n    return requiredRoles.includes(user.role);\n  };\n  const isAuthenticated = () => {\n    return !!user && !!localStorage.getItem('token');\n  };\n  const value = {\n    user,\n    loading,\n    error,\n    login,\n    logout,\n    checkAuth,\n    hasRole,\n    isAuthenticated: isAuthenticated(),\n    setError\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 9\n  }, this);\n};\n_s2(AuthProvider, \"PA9FxEY9xSNRrsSqaLtbYei52Hs=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","apiService","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","AuthProvider","children","_s2","user","setUser","loading","setLoading","error","setError","checkAuth","console","log","token","localStorage","getItem","savedUser","hasToken","hasUser","substring","response","api","get","status","userData","JSON","parse","verifyError","message","removeItem","err","login","email","password","result","success","data","_err$response","_err$response$data","errorMessage","logout","hasRole","requiredRoles","Array","isArray","includes","role","isAuthenticated","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/kassymzhan.nuraliyev/OneDrive - KAZ Minerals Management LLP/Desktop/Tablo/Tablo/frontend/src/contexts/AuthContext.js"],"sourcesContent":["// frontend/src/contexts/AuthContext.js\r\nimport React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport apiService from '../services/api';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\r\n    useEffect(() => {\r\n        checkAuth();\r\n    }, []);\r\n\r\n    // frontend/src/contexts/AuthContext.js\r\n\r\n    const checkAuth = async () => {\r\n        console.log('üîê Checking authentication...');\r\n\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            const savedUser = localStorage.getItem('user');\r\n\r\n            console.log('üì¶ Saved data:', {\r\n                hasToken: !!token,\r\n                hasUser: !!savedUser,\r\n                token: token ? `${token.substring(0, 20)}...` : 'none'\r\n            });\r\n\r\n            if (token && savedUser) {\r\n                console.log('‚úÖ Found saved token and user');\r\n\r\n                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ /api/auth/verify\r\n                try {\r\n                    const response = await api.get('/auth/verify');\r\n\r\n                    if (response.status === 200) {\r\n                        const userData = JSON.parse(savedUser);\r\n                        setUser(userData);\r\n                        console.log('‚úÖ User restored:', userData);\r\n                    } else {\r\n                        throw new Error('Token validation failed');\r\n                    }\r\n                } catch (verifyError) {\r\n                    console.log('‚ùå Token invalid, clearing...', verifyError.message);\r\n                    localStorage.removeItem('token');\r\n                    localStorage.removeItem('user');\r\n                    setUser(null);\r\n                }\r\n            } else {\r\n                console.log('‚ÑπÔ∏è No saved authentication found');\r\n                setUser(null);\r\n            }\r\n        } catch (err) {\r\n            console.error('‚ùå Auth check error:', err);\r\n            setError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');\r\n            setUser(null);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const login = async (email, password) => {\r\n        console.log('Login attempt for:', email);\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const result = await apiService.login(email, password);\r\n\r\n            if (result.success) {\r\n                console.log('Login successful:', result.data);\r\n                setUser(result.data.user);\r\n                setError(null);\r\n                return { success: true };\r\n            } else {\r\n                console.log('Login failed:', result.error);\r\n                setError(result.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');\r\n                return { success: false, error: result.error };\r\n            }\r\n        } catch (err) {\r\n            console.error('Login error:', err);\r\n            const errorMessage = err.response?.data?.message || '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';\r\n            setError(errorMessage);\r\n            return { success: false, error: errorMessage };\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        console.log('Logging out...');\r\n        setUser(null);\r\n        setError(null);\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        // –ù–µ –¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –∑–¥–µ—Å—å, –ø—É—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç\r\n    };\r\n\r\n    const hasRole = (requiredRoles) => {\r\n        if (!user) return false;\r\n        if (!Array.isArray(requiredRoles)) {\r\n            requiredRoles = [requiredRoles];\r\n        }\r\n        return requiredRoles.includes(user.role);\r\n    };\r\n\r\n    const isAuthenticated = () => {\r\n        return !!user && !!localStorage.getItem('token');\r\n    };\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        error,\r\n        login,\r\n        logout,\r\n        checkAuth,\r\n        hasRole,\r\n        isAuthenticated: isAuthenticated(),\r\n        setError\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}